<!DOCTYPE html>
<html>
<head>
  <link rel="stylesheet" type="text/css" href="../static/css/quiz.css">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1, user-scalable=0">
</head>
<body>

  <h2>Quiz</h2>

  <span id="showmns">00</span>:<span id="showscs">00</span>

  <div id="start">
    <button type="button" onclick="startquiz()">StartQuiz</button>
  </div>

  <div id="myQuiz" display="none">
    <p id="qn_id"></p>
    <p id="Q1"></p>
    <p id="Q2"></p>
    <p id="Q3"></p>
    <p id="Q4"></p>
    <p id="Q5"></p>
    <p id="A"></p>
    <p id="B"></p>
    <p id="C"></p>
    <p id="D"></p>
    <p id="Answer"></p>
    <form id="myForm" action="/action_page.php">
      <input type="text" id="UserAnswer" display="none"><br>
    </form>

    <button type="button" onclick="submit()" id='btnct' display="none">submit</button>
  </div>

  <p id="Result"></p>
  
  <p id="demo"></p>

  <script>

    // Define Variables

    var myQuestions = "joy";
    var data = {};
    var qn_id = 0;
    var q1 = document.getElementById("Q1");
    var q2 = document.getElementById("Q2");
    var q3 = document.getElementById("Q3");
    var q4 = document.getElementById("Q4");
    var q5 = document.getElementById("Q5");
    var a = document.getElementById("A");
    var b = document.getElementById("B");
    var c = document.getElementById("C");
    var d = document.getElementById("D");

    var answer = document.getElementById("Answer");
    var userAnswer = document.getElementById("UserAnswer");
    var result = document.getElementById("Result");

    // Toggler

    function hideshow(DIV) {
        var x = document.getElementById(DIV);
        if (x.style.display === "none") {
            x.style.display = "block";
        } else {
            x.style.display = "none";
        }
    }
    hideshow('myQuiz');

    // AJAX

    function randomize(a, b) {
      return Math.random() - 0.5;
    }

    function startquiz() {
      var xhttp = new XMLHttpRequest();
      xhttp.onreadystatechange = function() {
        if (this.readyState == 4 && this.status == 200) {
          rawdata = JSON.parse(this.response);
          data = rawdata.sort(randomize);
          updateqn();
          starttimer();
        }
      };
      xhttp.open("GET", "http://empirestreet.com.au/questionlist", true);
      xhttp.send();
      hideshow('start');
      hideshow('myQuiz');
    };

    function updateqn() {
      q1.innerHTML = data[qn_id].Q1;
      q2.innerHTML = data[qn_id].Q2;
      q3.innerHTML = data[qn_id].Q3;
      q4.innerHTML = data[qn_id].Q4;
      q5.innerHTML = data[qn_id].Q5;
      a.innerHTML = data[qn_id].A;
      b.innerHTML = data[qn_id].B;
      c.innerHTML = data[qn_id].C;
      d.innerHTML = data[qn_id].D;
      answer.innerHTML = data[qn_id].Answer;
      userAnswer.value = "";
    }

    function submit() {
      if (userAnswer.value.toLowerCase()  === data[qn_id].Answer.toLowerCase() ) {
        result.innerHTML = "Correct! Gained 90 Seconds";  
        starttimer();
      } else {
        result.innerHTML = "Incorrect! No time gained"; 
      };

      qn_id += 1; 
      updateqn();  
    };


    // Clock Stuff

    var mns = 0;
    var scs = 10;
    var btcnt = document.getElementById('btnct');
    var showmns = document.getElementById('showmns');
    var showscs = document.getElementById('showscs');

    var count = 0;

    function pad2(n) {
        return n < 10 ? '0' + n : n;
    };

    function show() {
        var s = count % 60;
        var m = Math.floor(count / 60);
        showmns.innerHTML = pad2(m);
        showscs.innerHTML = pad2(s);
        document.getElementById('qn_id').innerHTML = qn_id;
    };

    function timer() {
        show();
        if (count-- > 0) {
            setTimeout(timer, 1000);
        } else {
          alert();
        };

    };
    
    function starttimer() {
      var s = parseInt(scs, 10);
      var m = parseInt(mns, 10);
      if (isNaN(s) || isNaN(m)) return;
      scs = s;
      mns = m;
   
      var current = count;
      count += (m * 60) + s;

      // only restart the counter loop if it was previously stopped
      if (current <= 0) {
          timer();
      } else {
          show();
      };

    };

  </script>

</body>
</html>