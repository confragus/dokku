<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <title>Quiz App</title>
  
  <link href="https://fonts.googleapis.com/css?family=Dosis:400,700" rel="stylesheet">

  <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
  <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS_CHTML"></script>

  <style>
    #root {
    ; /* collapse WS, preserve LB */
    }
    #root img{
      max-width:99%;
      height:auto;
    }
  </style>
  <link rel="stylesheet" type="text/css" href="../static/css/quiz.css">
  <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='css/quiz.css') }}">

</head>

<body>

  <div id="root"></div>
  <script>

    function show(x) {
      x.style.display = "block";
    }

    function hide(x){
      x.style.display = "none";
    }

    // Access div in index.html
    const app = document.getElementById('root');

    // set up container
    const container = document.createElement('div');
    container.setAttribute('class', 'container');

    // add logo and containder to the app root
    app.appendChild(container);

    // Create a request variable and assign a new XMLHttpRequest object to it.
    var request = new XMLHttpRequest();

    // Open a new connection, using the GET request on the URL endpoint
    request.open('GET', 'http://empirestreet.com.au/questionlist', true);
    request.onload = function () {

    // Begin accessing JSON data here
    var data = JSON.parse(this.response);

      data.forEach(question => {
        // Create a div with a card class
        const card = document.createElement('div');
        card.setAttribute('class', 'card');

        const p_id = document.createElement('h1');
        const p_question = document.createElement('p');
        const i_question = document.createElement('img');
        const p_q1 = document.createElement('p');
        const p_q2 = document.createElement('p');
        const p_q3 = document.createElement('p');
        const i_q1 = document.createElement('input');
        const i_q2 = document.createElement('input');
        const i_q3 = document.createElement('input');
        const b_q1 = document.createElement('button');
        
        const p_r1 = document.createElement('h5');
        const p_r2 = document.createElement('h5');
        const p_r3 = document.createElement('h5');

        const p_a1 = document.createElement('h5');
        const p_a2 = document.createElement('h5');
        const p_a3 = document.createElement('h5');
        const p_s1 = document.createElement('h5');
        const p_s2 = document.createElement('h5');
        const p_s3 = document.createElement('h5');

        function marks(x){
          if (x === '1'){
            return " (" + x + " mark)"
          } else {
            return " (" + x + " marks)"
          }
        }

        p_id.textContent = question.Subject + "-" + question.Year + " Q-"
          + question.ID + question.ID2;  
        p_question.textContent = question.Question;
        p_q1.textContent = question.Q1 + marks(question.M1);
        p_q2.textContent = question.Q2 + marks(question.M2); 
        p_q3.textContent = question.Q3 + marks(question.M3);
        MathJax.Hub.Queue(['Typeset', MathJax.Hub, p_question]);
        MathJax.Hub.Queue(['Typeset', MathJax.Hub, p_q1]);
        MathJax.Hub.Queue(['Typeset', MathJax.Hub, p_q2]);
        MathJax.Hub.Queue(['Typeset', MathJax.Hub, p_q3]);
        
        // Check if static html
        if (location.hostname === "") {
          i_question.setAttribute('src',"../static/img/qn/"+ question.Picture +".png");
        } else {
          i_question.setAttribute('src',"{{ url_for('static', filename='img/qn/') }}"+ question.Picture +".png"); 
        };

        b_q1.addEventListener("click", myClickScript);
        b_q1.textContent = "submit"

        p_a1.textContent = "Answer is: " + question.A1;
        p_a2.textContent = "Answer is: " + question.A2;
        p_a3.textContent = "Answer is: " + question.A3;
        p_s1.textContent = question.S1;
        p_s2.textContent = question.S2;
        p_s3.textContent = question.S3;
        
        hide(p_a1);
        hide(p_a2);
        hide(p_a3);
        
        hide(p_s1);
        hide(p_s2);
        hide(p_s3);

        function myClickScript() {
          // force answer on all inputs
          if (i_q1.value ==="" || 
              i_q2.value === "" && question.Q2 != "" || 
              i_q3.value === "" && question.Q3 != "") {
            return;
          } else {
            hide(b_q1);
            checkAnswers(i_q1,question.A1,p_r1,p_a1,p_s1);
            checkAnswers(i_q2,question.A2,p_r2,p_a2,p_s2);
            checkAnswers(i_q3,question.A3,p_r3,p_a3,p_s3);
          }
        }

        function checkAnswers(i_q,q_,p_r,p_a,p_s){
          i_q.readOnly = true;
          if (i_q.value.toLowerCase() === q_.toLowerCase() || 
          parseFloat(i_q.value) === parseFloat(q_)) {
            p_r.textContent = "Correct!";
          } else {
            p_r.textContent = "Incorrect!"
          };
          show(p_a);
          show(p_s);
        }

        // Append the cards to the container element
        container.appendChild(card);

        card.appendChild(p_id);
        card.appendChild(p_question);
        if( question.Picture != "") {
          card.appendChild(i_question);
        };
        card.appendChild(p_q1);
        card.appendChild(i_q1);
        card.appendChild(p_r1);
        card.appendChild(p_a1);
        card.appendChild(p_s1);
        if (question.Q2 != "") {
          card.appendChild(p_q2);
          card.appendChild(i_q2);
          card.appendChild(p_r2);
          card.appendChild(p_a2);
          card.appendChild(p_s2);
        };
        if (question.Q3 != "") {
          card.appendChild(p_q3);
          card.appendChild(i_q3);
          card.appendChild(p_r3);
          card.appendChild(p_a3);
          card.appendChild(p_s3);
        };
        card.appendChild(b_q1);
      });
    }
    request.send();
  </script>
</body>

</html>